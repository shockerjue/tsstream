<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Tsstream Monitor</title>
    </head>
<style>

    .link {
        fill: #f00;
        stroke: #666;
        stroke-width: 1.5px;
    }

    #licensing {
        fill: green;
    }

    .link.licensing {
        stroke: green;
    }

    .link.resolved {
        stroke-dasharray: 0,2 1;
    }

    circle {
        fill: #ccc;
        stroke: #333;
        stroke-width: 1.5px;
    }

    text {
        font: 12px Microsoft YaHei;
        pointer-events: none;
        text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
    }

    .linetext {
        font-size: 12px Microsoft YaHei;
    }
</style>
<script src="echarts.min.js"></script>
<script type="text/javascript">
    function sendGetHttpRequest(url,okcallback,failcallback) {
        var http = new XMLHttpRequest();
        http.open("GET",url,true);
        http.onreadystatechange = function() {
            if(http.readyState == 4) {
                if(http.status == 200) {
                    try {
                        var json = eval("(" + http.responseText + ")");
                        if(null != okcallback) {
                            okcallback(json);
                        }
                    }catch(err) {
                        alert(err);
                    }
                }else {
                    alert(http.responseText);
                }
            }
        }

        http.send();
    }

    function OnRequestCallback(json) {
        var body = document.body;
        body.removeChild(body.firstChild);

        var parent = json["data"]["genesis"];
        var data = {};
        data["name"] = parent["nodeinfo"]["name"];
        if(0 < parent["nextnode"].lenght) {
            data["children"] = [];
            for(var j = 0; j < parent["nextnode"].length; ++j) {
                var child = children(parent["nexrnode"][j]["hash"],json)
                data["children"].push(child);
            }
        }else {
            data["value"] = parent["nodeinfo"]["name"];
        }
        

        var width = window.screen.availWidth - 50;
        var height = window.screen.availHeight - 150;
        var main = document.getElementById('main');
        main.style.cssText = "height:" + height + "px;width:" + width + "px;background: white;";
        var myChart = echarts.init(document.getElementById('main'));
        myChart.setOption(option = {
            tooltip: {
                trigger: 'item',
                triggerOn: 'mousemove'
            },
            series: [{
                type: 'tree',
                initialTreeDepth: -1,
                data: [data],

                top: '1%',
                left: '7%',
                bottom: '1%',
                right: '20%',

                symbolSize: 10,

                label: {
                    normal: {
                        position: 'left',
                        verticalAlign: 'middle',
                        align: 'right',
                        color: 'black'
                    }
                },

                leaves: {
                    label: {
                        normal: {
                            position: 'right',
                            verticalAlign: 'middle',
                            align: 'left',
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: {
                                type: 'radial',
                                x: 0.5,
                                y: 0.5,
                                r: 0.5,
                                colorStops: [{
                                    offset: 0,
                                    color: 'red' // 0% 处的颜色
                                }, {
                                    offset: 1,
                                    color: 'blue' // 100% 处的颜色
                                }],
                                globalCoord: false // 缺省为 false
                            }
                        }
                    },
                },
            }]
        });
    }

    function children(hash,json){
        var data = {};
        var parent = json["data"][hash];
        data["name"] = parent["nodeinfo"]["name"];
        if(0 == parent["nextnode"].lenght){
            data["value"] = parent["nodeinfo"]["name"];
            
            return;
        }

        data["children"] = [];
        for(var j = 0; j < parent["nextnode"].length; ++j) {
            var child = {
                "name": parent["nextnode"][j]["name"],
                symbolSize: 16,
                label: {
                    fontSize: 16,
                    color: "#000" //字体颜色
                },
                itemStyle: {
                    color: "#ff0000", //这是节点折叠时候的颜色
                    borderColor: '#0000ff',
                    borderWidth: 3,
                    normal: {
                        show: false,
                        color: {
                            type: 'radial',
                            x: 0.5,
                            y: 0.5,
                            r: 0.5,
                            colorStops: [{
                                offset: 0,
                                color: 'green' // 0% 处的颜色
                            }, {
                                offset: 1,
                                color: 'white' // 100% 处的颜色
                            }],
                            globalCoord: false // 缺省为 false
                        },
                        borderColor: 'blue',
                        borderWidth: 2,
                        shadowColor: 'rgba(0, 0, 0, 1)',
                        shadowBlur: 10
                    },
                    emphasis: {
                        color: {
                            type: 'radial',
                            x: 0.5,
                            y: 0.5,
                            r: 0.5,
                            colorStops: [{
                                offset: 0,
                                color: 'green' // 0% 处的颜色
                            }, {
                                offset: 1,
                                color: 'white' // 100% 处的颜色
                            }],
                            globalCoord: false // 缺省为 false
                        }
                    }
                },
                lineStyle: {
                    color: "#888",
                    width: 4,
                    type: 'solid' //'dotted'虚线 'solid'实线
                }
            };

            child["children"] = children(parent["nextnode"][j]["hash"]);
            data["children"].push(child);
        }

        return data;
    }

    function OnInterval() {
        sendGetHttpRequest("http://api.monitor.0letter.com/monitor",OnRequestCallback,null);
    }

    OnInterval();
    // setInterval(OnInterval,60 * 1000);
</script>

<body style="background:#666;align-content: center;">
    <center>
        <div id="main" style="width: 600px;height:400px;background: white;"></div>
    </center>
</body>
</html>